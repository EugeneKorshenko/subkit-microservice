<!DOCTYPE html>
<html>
	<head>
		<title>Subkit Angular Chat</title>
		<script src="public/lib/angularjs/angular.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="/subkit.js"></script>
		<script src="/angularsubkit.js"></script>
	</head>
	<body>
		<div data-ng-app="chat" data-ng-controller="Chat">
		  <form>
		    Your name: <input type="text" data-ng-model="username">
		  </form>
		  <div data-ng-cloak data-ng-repeat="message in messages">
		    <em>{{message.from}}: </em>{{message.content}}
		  </div>
		  <br/>
		  <form data-ng-submit="addMessage()">
		    <input type="text" data-ng-model="message" placeholder="Message...">
		    <button type="submit">
		      <i> Send</i>
		    </button>
		  </form>
		</div>

		<script>
		 	angular.module('chat', ['subkit']).controller('Chat', ['$scope', 'angularSubkit', function($scope, angularSubkit) {
			    var subkit = new Subkit({
					baseUrl: "@locals.url",
					apiKey: "@locals.apiKey"
				});
				var messages = angularSubkit(subkit, $scope, "messages", []);
				$scope.username = 'Guest' + Math.floor(Math.random()*101);
				$scope.addMessage = function() {
					messages.set($scope.username, {
						from: $scope.username,
						content: $scope.message
					});
					$scope.message = "";
				}
			}]);
		</script>
	</body>
</html>